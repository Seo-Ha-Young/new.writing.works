<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>게시물</title>
    <link rel="stylesheet" href="/css/css.css" />
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function (e) {
        $("#header").load("header"); // 원하는 파일 경로를 삽입하면 된다
        $("#footers").load("common/footer.html"); // 추가 인클루드를 원할 경우 이런식으로 추가하면 된다

         var no = [[${dto.no}]];
         console.log(no);

        function getPostReviews() {
           function formatTime(str) {
                          var date = new Date(str);
                          return date.getFullYear()+'/'+(date.getMonth()+1)+'/'+date.getDate()+' '+date.getHours()+':'+date.getMinutes();
           }
          $.getJSON("/reviews/"+no+"/all", function(arr) {
            var str="";
            $.each(arr, function(idx, review) {
              str += '<div class="no" data-no='+review.post_no+' ><br>';
              str += '<a class="id">'+review.id+'</a><br>';
              str += '<a class="content">'+review.review_content+'</a><br>';
              str += '<a class="text">'+formatTime(review.regDate)+'</a>';
              str += '</div><br>';
            });
             console.log(str);
            $("#reviewList").html(str);
          });
        }

         getPostReviews();

         var id = "닉네임"+(Math.floor(Math.random()*5));
         var content = $('textarea[name="reply"]');

         $(".btn_reply").click(function(){
            var data = {no:post_no, review_content:content.val(), id:id.val() };
            console.log(data);

            $.ajax({
                url:"/reviews/"+no,
                type:"post",
                data:JSON.stringify(data),
                contentType:"application/json; charset=utf-8",
                dataType:"text",
                success: function(result){
                    console.log("result :"+result);
                    self.location.reload();
                }
            });
         });


      });
    </script>
  </head>
  <body>

    <div id="header"></div>
    <div class="board_wrap">
      <div class="board_title">
        <strong>이미지</strong>
        <p>이미지</p>
      </div>
      <div class="board_view_wrap">
        <div class="board_view">
          <div class="title">[[${dto.post_name}]]</div>
          <div class="info">
            <dl>
              <dt>번호</dt>
              <dd>[[${dto.no}]]</dd>
            </dl>
            <dl>
              <dt>글쓴이</dt>
              <dd>[[${dto.writer}]]</dd>
            </dl>
            <dl>
              <dt>작성일</dt>
              <dd>[[${#temporals.format(dto.regDate, 'yyyy/MM/dd')}]]</dd>
            </dl>
            <dl>
              <dt>추천수</dt>
              <dd>11</dd>
            </dl>
          </div>
          <div class="cont">
            <img th:src="|/wcs/image/display2?fileNo=${dto.image_no}|"><br>
            [[${dto.post_content}]]
          </div>
        </div>

        <div class="bt_wrap">
            <a th:href="@{/html/board(page= ${requestDTO.page}, type= ${requestDTO.type}, keyword= ${requestDTO.keyword})}" class="'on">
                목록
            </a>
        </div>

        <div class="list-group reviewList" id="reviewList">

        </div>

        <div class="reply_content">
          <form onsubmit="addComment(event)">
            <div class="form-group">
              <textarea name="reply" id="reply"></textarea>
              <button type="submit" class="btn_reply">작성</button>
            </div>
          </form>
          <div class="comments mt-3">

          </div>
        </div>
      </div>
    </div>
  </body>
</html>
